geom_point()
# ---------- change aesthetics
ggplot(mtcars, aes(x = wt, y = mpg)) +
geom_point()
# change color and size
# color argument has to be inside aes()!
ggplot(mtcars, aes(x = wt, y = mpg, color = disp, size = disp)) +
geom_point()
# ---------- change geometry
diamonds.sub <- diamonds[1:1000, ]
str(diamonds.sub)
ggplot(diamonds.sub, aes(x = carat, y = price)) + geom_point() + geom_smooth()
# alpha is the parameter for visibility
ggplot(diamonds.sub, aes(x = carat, y = price, color = clarity)) +
geom_point(alpha = 0.4)
# ---------- another way of doing it
dia_plot <- ggplot(diamonds.sub, aes(x = carat, y = price))
# Add the same geom layer, but with aes() inside
dia_plot + geom_point(aes(color = clarity))
# -------------------- compare with base
mtcars$cyl <- as.factor(mtcars$cyl)
plot(mtcars$wt, mtcars$mpg, col = mtcars$cyl)
abline(lm(mpg ~ wt, data = mtcars), lty = 2)
# one regression for each cyl group
lapply(mtcars$cyl, function(x) {
abline(lm(mpg ~ wt, mtcars, subset = (cyl == x)), col = x)
})
legend(x = 5, y = 33, legend = levels(mtcars$cyl),
col = 1:3, pch = 1, bty = "n")
# Plot 1: add geom_point() to this command to create a scatter plot
ggplot(mtcars, aes(x = wt, y = mpg, col = cyl)) + geom_point()
# Plot 2: include the lines of the linear models, per cyl
ggplot(mtcars, aes(x = wt, y = mpg, col = cyl)) +
geom_point() +
geom_smooth(method = 'lm', se = FALSE)
# Plot 3: include a lm for the entire dataset in its whole
ggplot(mtcars, aes(x = wt, y = mpg, col = cyl)) +
geom_point() +
geom_smooth(method = 'lm', se = FALSE) +
geom_smooth(aes(group = 1), method = 'lm', se = FALSE, linetype = 2)
# --------------- aesthetics
ggplot(mtcars, aes(x = wt, y = mpg, color = cyl)) +
geom_point(shape = 1, size = 4)
# Change shape and alpha of the points in the above plot
ggplot(mtcars, aes(x = wt, y = mpg, fill = cyl)) +
geom_point(shape = 21, size = 4, alpha = 0.6)
# Map am to col in the above plot
ggplot(mtcars, aes(x = wt, y = mpg, fill = cyl, col = am)) +
geom_point(shape = 21, size = 4, alpha = 0.6)
ggplot(mtcars, aes(x = wt, y = mpg, alpha = cyl)) +
geom_point()
# Map cyl to shape
ggplot(mtcars, aes(x = wt, y = mpg, shape = cyl)) +
geom_point()
# Map cyl to label
ggplot(mtcars, aes(x = wt, y = mpg, label = cyl)) +
geom_text()
my_color <- "#4ABEFF"
ggplot(mtcars, aes(x = wt, y = mpg, fill = cyl)) +
geom_point(color = my_color, size = 10, shape = 23, color = my_color)
ggplot(mtcars, aes(x = wt, y = mpg, fill = cyl)) +
geom_text(label = rownames(mtcars), color = 'red')
ggplot(mtcars, aes(x = mpg, y = qsec,
color = factor(cyl),
shape = factor(am),
size = (hp/wt))) + geom_point()
# ------------------- base layer
cyl.am <- ggplot(mtcars, aes(x = factor(cyl), fill = factor(am)))
# bar plot (stacked)
cyl.am +
geom_bar()
cyl.am +
geom_bar(position = 'fill')  # show proportions
cyl.am +
geom_bar(position = 'dodge')
val = c("#E41A1C", "#377EB8")
lab = c("Manual", "Automatic")
cyl.am +
geom_bar(position = "dodge") +
scale_x_discrete('Cylinders') +
scale_y_continuous('Number') +
scale_fill_manual('Transmission',
values = val,  # change color
labels = lab)  # change label
library(ggplot2)
# qplot
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width)) +
geom_point()
# same as
qplot(Sepal.Length, Sepal.Width, data = iris)
qplot(Sepal.Length, Sepal.Width, data = iris,
geom = 'jitter', col = Species,
alpha = I(0.5))  # this I is needed
# --------- dot plot: x categorical, y continuous
# with geom_point()
ggplot(mtcars, aes(cyl, wt, col = am)) +
geom_point(position = position_jitter(0.2, 0))
# with geom_dotplot()
ggplot(mtcars, aes(factor(cyl), wt, fill = factor(am))) +
geom_dotplot(binaxis = "y", stackdir = 'center')
# with qplot()
qplot(
factor(cyl), wt,
data = mtcars,
fill = factor(am),
geom = 'dotplot',
binaxis = 'y',
stackdir = "center"
)
setwd("~/Dropbox/My Files/Mac/Programming/Web/chanlin/content/post")
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
shiny::runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
knitr::opts_chunk$set(warning = F, message = F)
options(warn = -1)
source("qi_r_function.r")
library(gganimate)
library(gifski)
library(ggimage)
library(lubridate)
library(usethis)
name <- "宇通客车"
today <- Sys.Date()
library(plotly)
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df3 <- df2 %>% group_by(name) %>% mutate(adj.close = (close /close[1] - 1) * 100  )
df3$date <-  as.Date(df3$date)
df3 <- data.frame(df3)
p <- ggplot() + geom_line(data=df3, aes(x=date, y=adj.close, color = name))
ggplotly(p)
ggplot(df3, aes(x=date,y=adj.close,group=name))
ggplot(df3, aes(x=date,y=adj.close,group=name)) + facet_grid(name ~ .)
ggplot(df3, aes(x=date,y=adj.close)) + facet_grid(name ~ .)
ggplot(df3, aes(x=date,y=adj.close)) + geom_line() +facet_grid(name ~ .)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line()
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name) +
geom_line(data = df3[df3$code == 510050], aes(date,adj.close), size = 1.25, color = "red")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name) +
geom_line(data = df3[df3$code == "510050"], aes(date,adj.close), size = 1.25, color = "red")
df3[df3$code == "510050"]
df3
df3$code == '510050'
df3[df3$code == '510050']
df3(df3$code == '510050')
df33 %>% filter(code == "510050")
df3 %>% filter(code == "510050")
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name) +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red")
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_grid(~name) +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red")
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name) +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red")
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~name)
df_510050 = df3 %>% filter(code == "510050"),
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5)
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5)
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5)
blogdown:::serve_site()
library(ggridges)
pr <- ggplot(df3, aes(date, name, height=adj.close / 10, group = name)) + geom_ridgeline(fill="lightblue")
#d <- data.frame(x = rep(1:5, 3), y = c(rep(0, 5), rep(1, 5), rep(3, 5)),
#             height = c(0, 1, 3, 4, 0, 1, 2, 3, 5, 4, 0, 5, 4, 4, 1))
#ggplot(d, aes(x, y, height = height, group = y)) + geom_ridgeline(fill="lightblue")
#ggplot(movies[movies$year>1912,], aes(x = length, y = year, group = year)) +
#  geom_density_ridges(scale = 10, size = 0.25, rel_min_height = 0.03) +
#  theme_ridges() +
#  scale_x_continuous(limits=c(1, 200), expand = c(0.01, 0)) +
#  scale_y_reverse(breaks=c(2000, 1980, 1960, 1940, 1920, 1900), expand = c(0.01, 0))
pr
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5)
blogdown:::serve_site()
blogdown:::serve_site()
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5, scales = free)
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5, scales = "free")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(adj.close), color = "red") +  facet_wrap(~ name, ncol = 5, scales = "free")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date, adj.close), color = "red") +  facet_wrap(~ name, ncol = 5, scales = "free")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free")
geom_line(data = df_510050, aes(date, adj.close), color = "red")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free")
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(adj.close), colour = "red")
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
blogdown:::serve_site()
View(df2)
View(df3)
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df2<- df2 %>% select(date,close,name) %>% pivot_wider(names_from = date, values_from = close)
row.names(df2) <- df2$name
df2$name = NULL
df2.norm = t(BBmisc::normalize(t(df2), method="standardize",margin=2))
df2<-t(scale(t(df2)))
library(ape)
disMatrix <-  dist(df2, method="euclidean")
hc<- hclust(disMatrix, method="average")
colors =c("red","blue","green","black")
clus4 = cutree(hc,4)
#plot(as.phylo(hc), type="fan", tip.color = colors[clus4],label.offset =0 , cex=1)
library(dtwclust)
lastcol = df2[,ncol(df2)]
print(lastcol[is.na(lastcol)])
clust.hier <- tsclust(df2, type="h",k=10L,distance="dtw")
View(df2)
knitr::opts_chunk$set(warning = F, message = F)
options(warn = -1)
source("qi_r_function.r")
library(gganimate)
library(gifski)
library(ggimage)
library(lubridate)
library(usethis)
name <- "宇通客车"
today <- Sys.Date()
library(plotly)
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df3 <- df2 %>% group_by(name) %>% mutate(adj.close = (close /close[1] - 1) * 100  )
df3$date <-  as.Date(df3$date)
df3 <- data.frame(df3)
p <- ggplot() + geom_line(data=df3, aes(x=date, y=adj.close, color = name))
ggplotly(p)
library(ggridges)
pr <- ggplot(df3, aes(date, name, height=adj.close / 10, group = name)) + geom_ridgeline(fill="lightblue")
#d <- data.frame(x = rep(1:5, 3), y = c(rep(0, 5), rep(1, 5), rep(3, 5)),
#             height = c(0, 1, 3, 4, 0, 1, 2, 3, 5, 4, 0, 5, 4, 4, 1))
#ggplot(d, aes(x, y, height = height, group = y)) + geom_ridgeline(fill="lightblue")
#ggplot(movies[movies$year>1912,], aes(x = length, y = year, group = year)) +
#  geom_density_ridges(scale = 10, size = 0.25, rel_min_height = 0.03) +
#  theme_ridges() +
#  scale_x_continuous(limits=c(1, 200), expand = c(0.01, 0)) +
#  scale_y_reverse(breaks=c(2000, 1980, 1960, 1940, 1920, 1900), expand = c(0.01, 0))
pr
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df2<- df2 %>% select(date,close,name) %>% pivot_wider(names_from = date, values_from = close)
row.names(df2) <- df2$name
df2$name = NULL
df2.norm = t(BBmisc::normalize(t(df2), method="standardize",margin=2))
df2<-t(scale(t(df2)))
library(ape)
disMatrix <-  dist(df2, method="euclidean")
hc<- hclust(disMatrix, method="average")
colors =c("red","blue","green","black")
clus4 = cutree(hc,4)
#plot(as.phylo(hc), type="fan", tip.color = colors[clus4],label.offset =0 , cex=1)
library(dtwclust)
lastcol = df2[,ncol(df2)]
print(lastcol[is.na(lastcol)])
clust.hier <- tsclust(df2, type="h",k=10L,distance="dtw")
View(df2)
blogdown:::serve_site()
install.packages("tidyquant")
knitr::opts_chunk$set(warning = F, message = F)
options(warn = -1)
source("qi_r_function.r")
library(gganimate)
library(gifski)
library(ggimage)
library(lubridate)
library(usethis)
library(tidyquant)
name <- "宇通客车"
today <- Sys.Date()
library(plotly)
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df3 <- df2 %>% group_by(name) %>% mutate(adj.close = (close /close[1] - 1) * 100  )
df3$date <-  as.Date(df3$date)
df3 <- data.frame(df3)
p <- ggplot() + geom_line(data=df3, aes(x=date, y=adj.close, color = name))
ggplotly(p)
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
View(df3)
df3 >
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
theme_tq() +  facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
theme_tq() +  facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
facet_wrap(~ name, ncol = 5, scales = "free")
?geom_candlestick
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free") + theme_tq_dark()
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free") + theme_tq()
?geom_ma
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(ma_fun = SMA, n = 5, color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 5, color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 20, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 10, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 5, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
blogdown:::serve_site()
?geom_candlestick
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close), fill_up = "black") +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 5, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df2<- df2 %>% select(date,close,name) %>% pivot_wider(names_from = date, values_from = close)
row.names(df2) <- df2$name
df2$name = NULL
df2.norm = t(BBmisc::normalize(t(df2), method="standardize",margin=2))
df2<-t(scale(t(df2)))
library(ape)
disMatrix <-  dist(df2, method="euclidean")
hc<- hclust(disMatrix, method="average")
colors =c("red","blue","green","black")
clus4 = cutree(hc,4)
#plot(as.phylo(hc), type="fan", tip.color = colors[clus4],label.offset =0 , cex=1)
library(dtwclust)
lastcol = df2[,ncol(df2)]
print(lastcol[is.na(lastcol)])
clust.hier <- tsclust(df2, type="h",k=10L,distance="dtw")
plot(as.phylo(clust.hier), type="fan", tip.color = colors[clus4],label.offset =0 , cex=1)
plot(clust.hier,type="sc")
sort(clust.hier@cluster)
ls
ls
ls
blogdown:::serve_site()
setwd("~/Dropbox/My Files/Mac/Programming/Web/hugo/content/post")
blogdown:::serve_site()
blogdown:::serve_site()
setwd("~/Dropbox/My Files/Mac/Programming/Web/hugo/content/post")
blogdown:::serve_site()

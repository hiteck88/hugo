runApp()
runApp()
runApp()
runApp()
runApp()
knitr::opts_chunk$set(warning = F, message = F)
options(warn = -1)
source("qi_r_function.r")
library(gganimate)
library(gifski)
library(ggimage)
library(lubridate)
library(usethis)
name <- "宇通客车"
today <- Sys.Date()
library(plotly)
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df3 <- df2 %>% group_by(name) %>% mutate(adj.close = (close /close[1] - 1) * 100  )
df3$date <-  as.Date(df3$date)
df3 <- data.frame(df3)
p <- ggplot() + geom_line(data=df3, aes(x=date, y=adj.close, color = name))
ggplotly(p)
ggplot(df3, aes(x=date,y=adj.close,group=name))
ggplot(df3, aes(x=date,y=adj.close,group=name)) + facet_grid(name ~ .)
ggplot(df3, aes(x=date,y=adj.close)) + facet_grid(name ~ .)
ggplot(df3, aes(x=date,y=adj.close)) + geom_line() +facet_grid(name ~ .)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line()
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name) +
geom_line(data = df3[df3$code == 510050], aes(date,adj.close), size = 1.25, color = "red")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name) +
geom_line(data = df3[df3$code == "510050"], aes(date,adj.close), size = 1.25, color = "red")
df3[df3$code == "510050"]
df3
df3$code == '510050'
df3[df3$code == '510050']
df3(df3$code == '510050')
df33 %>% filter(code == "510050")
df3 %>% filter(code == "510050")
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name) +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red")
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_grid(~name) +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red")
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~name) +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red")
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~name)
df_510050 = df3 %>% filter(code == "510050"),
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5)
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5)
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5)
blogdown:::serve_site()
library(ggridges)
pr <- ggplot(df3, aes(date, name, height=adj.close / 10, group = name)) + geom_ridgeline(fill="lightblue")
#d <- data.frame(x = rep(1:5, 3), y = c(rep(0, 5), rep(1, 5), rep(3, 5)),
#             height = c(0, 1, 3, 4, 0, 1, 2, 3, 5, 4, 0, 5, 4, 4, 1))
#ggplot(d, aes(x, y, height = height, group = y)) + geom_ridgeline(fill="lightblue")
#ggplot(movies[movies$year>1912,], aes(x = length, y = year, group = year)) +
#  geom_density_ridges(scale = 10, size = 0.25, rel_min_height = 0.03) +
#  theme_ridges() +
#  scale_x_continuous(limits=c(1, 200), expand = c(0.01, 0)) +
#  scale_y_reverse(breaks=c(2000, 1980, 1960, 1940, 1920, 1900), expand = c(0.01, 0))
pr
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5)
blogdown:::serve_site()
blogdown:::serve_site()
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5, scales = free)
df_510050 = df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date,adj.close), size = 1.25, color = "red") +  facet_wrap(~ name, ncol = 5, scales = "free")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(adj.close), color = "red") +  facet_wrap(~ name, ncol = 5, scales = "free")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() +
geom_line(data = df_510050, aes(date, adj.close), color = "red") +  facet_wrap(~ name, ncol = 5, scales = "free")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free")
geom_line(data = df_510050, aes(date, adj.close), color = "red")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free")
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
df_510050 =  df3 %>% filter(code == "510050")
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(adj.close), colour = "red")
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
blogdown:::serve_site()
View(df2)
View(df3)
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df2<- df2 %>% select(date,close,name) %>% pivot_wider(names_from = date, values_from = close)
row.names(df2) <- df2$name
df2$name = NULL
df2.norm = t(BBmisc::normalize(t(df2), method="standardize",margin=2))
df2<-t(scale(t(df2)))
library(ape)
disMatrix <-  dist(df2, method="euclidean")
hc<- hclust(disMatrix, method="average")
colors =c("red","blue","green","black")
clus4 = cutree(hc,4)
#plot(as.phylo(hc), type="fan", tip.color = colors[clus4],label.offset =0 , cex=1)
library(dtwclust)
lastcol = df2[,ncol(df2)]
print(lastcol[is.na(lastcol)])
clust.hier <- tsclust(df2, type="h",k=10L,distance="dtw")
View(df2)
knitr::opts_chunk$set(warning = F, message = F)
options(warn = -1)
source("qi_r_function.r")
library(gganimate)
library(gifski)
library(ggimage)
library(lubridate)
library(usethis)
name <- "宇通客车"
today <- Sys.Date()
library(plotly)
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df3 <- df2 %>% group_by(name) %>% mutate(adj.close = (close /close[1] - 1) * 100  )
df3$date <-  as.Date(df3$date)
df3 <- data.frame(df3)
p <- ggplot() + geom_line(data=df3, aes(x=date, y=adj.close, color = name))
ggplotly(p)
library(ggridges)
pr <- ggplot(df3, aes(date, name, height=adj.close / 10, group = name)) + geom_ridgeline(fill="lightblue")
#d <- data.frame(x = rep(1:5, 3), y = c(rep(0, 5), rep(1, 5), rep(3, 5)),
#             height = c(0, 1, 3, 4, 0, 1, 2, 3, 5, 4, 0, 5, 4, 4, 1))
#ggplot(d, aes(x, y, height = height, group = y)) + geom_ridgeline(fill="lightblue")
#ggplot(movies[movies$year>1912,], aes(x = length, y = year, group = year)) +
#  geom_density_ridges(scale = 10, size = 0.25, rel_min_height = 0.03) +
#  theme_ridges() +
#  scale_x_continuous(limits=c(1, 200), expand = c(0.01, 0)) +
#  scale_y_reverse(breaks=c(2000, 1980, 1960, 1940, 1920, 1900), expand = c(0.01, 0))
pr
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df2<- df2 %>% select(date,close,name) %>% pivot_wider(names_from = date, values_from = close)
row.names(df2) <- df2$name
df2$name = NULL
df2.norm = t(BBmisc::normalize(t(df2), method="standardize",margin=2))
df2<-t(scale(t(df2)))
library(ape)
disMatrix <-  dist(df2, method="euclidean")
hc<- hclust(disMatrix, method="average")
colors =c("red","blue","green","black")
clus4 = cutree(hc,4)
#plot(as.phylo(hc), type="fan", tip.color = colors[clus4],label.offset =0 , cex=1)
library(dtwclust)
lastcol = df2[,ncol(df2)]
print(lastcol[is.na(lastcol)])
clust.hier <- tsclust(df2, type="h",k=10L,distance="dtw")
View(df2)
blogdown:::serve_site()
install.packages("tidyquant")
knitr::opts_chunk$set(warning = F, message = F)
options(warn = -1)
source("qi_r_function.r")
library(gganimate)
library(gifski)
library(ggimage)
library(lubridate)
library(usethis)
library(tidyquant)
name <- "宇通客车"
today <- Sys.Date()
library(plotly)
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df3 <- df2 %>% group_by(name) %>% mutate(adj.close = (close /close[1] - 1) * 100  )
df3$date <-  as.Date(df3$date)
df3 <- data.frame(df3)
p <- ggplot() + geom_line(data=df3, aes(x=date, y=adj.close, color = name))
ggplotly(p)
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
View(df3)
df3 >
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
theme_tq() +  facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
theme_tq() +  facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
facet_wrap(~ name, ncol = 5, scales = "free")
?geom_candlestick
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free") + theme_tq_dark()
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free") + theme_tq()
?geom_ma
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(ma_fun = SMA, n = 5, color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 5, color = "darkgreen") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 20, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 10, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close)) +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 5, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
blogdown:::serve_site()
?geom_candlestick
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close), fill_up = "black") +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 5, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df2<- df2 %>% select(date,close,name) %>% pivot_wider(names_from = date, values_from = close)
row.names(df2) <- df2$name
df2$name = NULL
df2.norm = t(BBmisc::normalize(t(df2), method="standardize",margin=2))
df2<-t(scale(t(df2)))
library(ape)
disMatrix <-  dist(df2, method="euclidean")
hc<- hclust(disMatrix, method="average")
colors =c("red","blue","green","black")
clus4 = cutree(hc,4)
#plot(as.phylo(hc), type="fan", tip.color = colors[clus4],label.offset =0 , cex=1)
library(dtwclust)
lastcol = df2[,ncol(df2)]
print(lastcol[is.na(lastcol)])
clust.hier <- tsclust(df2, type="h",k=10L,distance="dtw")
plot(as.phylo(clust.hier), type="fan", tip.color = colors[clus4],label.offset =0 , cex=1)
plot(clust.hier,type="sc")
sort(clust.hier@cluster)
ls
ls
ls
setwd("~/Dropbox/My Files/Mac/Programming/Web/hugo")
setwd("~/Dropbox/My Files/Mac/Programming/Web/hugo/content/post")
knitr::opts_chunk$set(warning = F, message = F)
options(warn = -1)
source("qi_r_function.r")
library(gganimate)
library(gifski)
library(ggimage)
library(lubridate)
library(usethis)
library(tidyquant)
install.packages("tidyverse")
knitr::opts_chunk$set(warning = F, message = F)
options(warn = -1)
source("qi_r_function.r")
library(gganimate)
library(gifski)
library(ggimage)
library(lubridate)
library(usethis)
library(tidyquant)
install.packages("tidyquant")
knitr::opts_chunk$set(warning = F, message = F)
options(warn = -1)
source("qi_r_function.r")
library(gganimate)
library(gifski)
library(ggimage)
library(lubridate)
library(usethis)
library(tidyquant)
name <- "宇通客车"
today <- Sys.Date()
library(plotly)
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df3 <- df2 %>% group_by(name) %>% mutate(adj.close = (close /close[1] - 1) * 100  )
df3$date <-  as.Date(df3$date)
df3 <- data.frame(df3)
p <- ggplot() + geom_line(data=df3, aes(x=date, y=adj.close, color = name))
ggplotly(p)
library(ggridges)
install.packages("ggridges")
library(ggridges)
pr <- ggplot(df3, aes(date, name, height=adj.close / 10, group = name)) + geom_ridgeline(fill="lightblue")
#d <- data.frame(x = rep(1:5, 3), y = c(rep(0, 5), rep(1, 5), rep(3, 5)),
#             height = c(0, 1, 3, 4, 0, 1, 2, 3, 5, 4, 0, 5, 4, 4, 1))
#ggplot(d, aes(x, y, height = height, group = y)) + geom_ridgeline(fill="lightblue")
#ggplot(movies[movies$year>1912,], aes(x = length, y = year, group = year)) +
#  geom_density_ridges(scale = 10, size = 0.25, rel_min_height = 0.03) +
#  theme_ridges() +
#  scale_x_continuous(limits=c(1, 200), expand = c(0.01, 0)) +
#  scale_y_reverse(breaks=c(2000, 1980, 1960, 1940, 1920, 1900), expand = c(0.01, 0))
pr
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 5, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 6, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 6, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 6, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close), fill_up = "black") +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 5, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close), fill_up = "black") +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 5, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df)
df2<- df2 %>% select(date,close,name) %>% pivot_wider(names_from = date, values_from = close)
row.names(df2) <- df2$name
df2$name = NULL
df2.norm = t(BBmisc::normalize(t(df2), method="standardize",margin=2))
df2<-t(scale(t(df2)))
library(ape)
disMatrix <-  dist(df2, method="euclidean")
hc<- hclust(disMatrix, method="average")
colors =c("red","blue","green","black")
clus4 = cutree(hc,4)
#plot(as.phylo(hc), type="fan", tip.color = colors[clus4],label.offset =0 , cex=1)
library(dtwclust)
lastcol = df2[,ncol(df2)]
print(lastcol[is.na(lastcol)])
clust.hier <- tsclust(df2, type="h",k=10L,distance="dtw")
plot(as.phylo(clust.hier), type="fan", tip.color = colors[clus4],label.offset =0 , cex=1)
plot(clust.hier,type="sc")
sort(clust.hier@cluster)
library(gifski)
start_date = '2019-07-01'
end_date = today
code = '510050'
df = Qi$QA_fetch_data_day_adv(code, start_date, end_date)
df2 = rbind(mutate(df, name='50ETF', code = '510050'), py$df_my)
df3 <- df2 %>% group_by(name) %>% mutate(adj.close = close /close[1])
df3$date <-  as.Date(df3$date)
df3 <- data.frame(df3)
p2 <- ggplot() + geom_line(data=df3, aes(x=date, y=adj.close, group=name, color = name))
#t <- p2 + transition_reveal(as.numeric(date))
#gif <- animate(t, end_pause = 25, width = 800, height =400 , fps =8)
#gif
ggplotly(p2)
code = '510050'
output.gapTable(code)
par(mfrow=c(2,2))
output.stock(code)
output.stock(code)
output.stockWeek(code)
output.stockMonth(code)
code = '002939'
output.gapTable(code)
blogdown:::serve_site()
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close), fill_up = "black") +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 5, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
df3 %>%
ggplot(aes(x = date, y = close, group  = name)) +
geom_candlestick(aes(open = open, high = high, low = low, close = close), fill_up = "black") +
#labs(title = "AAPL Candlestick Chart", y = "Closing Price", x = "") +
#theme_tq() +
geom_ma(n = 5, color = "darkgreen", linetype= "solid") +
facet_wrap(~ name, ncol = 5, scales = "free")
blogdown:::serve_site()
df_510050 =  df3 %>% filter(code == "510050") %>% select(date, adj.close)
ggplot(df3, aes(x=date,y=adj.close, group=name)) + geom_line() + facet_wrap(~ name, ncol = 6, scales = "free") +
geom_line(data = df_510050, aes(date, adj.close), colour = "red")
